
resource "cloudflare_record" "rds" {
  domain = "{{ project_env_zone }}"
{% if project_deployment_environment == 'prod' %}
  name = "rds.{{ domain_name }}"
{% else %}
  name = "rds.{{ project_deployment_environment }}.{{ domain_name }}"
{% endif %}

{% if rds.cluster id defined and rds.cluster == True%}
  value = "${aws_rds_cluster.default.endpoint}"
{% else %}
  value = "${aws_db_instance.default.address}"
{% endif %}

  type = "CNAME"
  ttl = 300
}

{% if rds.cluster id defined and rds.cluster == True %}
resource "cloudflare_record" "rds_reader" {
  domain = "{{ project_env_zone }}"
{% if project_deployment_environment == 'prod' %}
  name = "reader.rds.{{ domain_name }}"
{% else %}
  name = "reader.rds.{{ project_deployment_environment }}.{{ domain_name }}"
{% endif %}

  value = "${aws_rds_cluster.default.reader_endpoint}"

  type = "CNAME"
  ttl = 300
}
{% endif %}
